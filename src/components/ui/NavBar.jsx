import { useEffect, useRef } from "react";
import { gsap } from "gsap";
import Lenis from "@studio-freight/lenis";
import { ScrollTrigger } from "gsap/ScrollTrigger";

export default function NavBar({ sectionRefs }) {
  const navBar = useRef(null);

  const cta = useRef(null);
  const tl = gsap.timeline();
  gsap.registerPlugin(ScrollTrigger);

  useEffect(() => {
    // Smooth scroll
    const lenis = new Lenis();
    function raf(time) {
      lenis.raf(time);
      requestAnimationFrame(raf);
    }
    requestAnimationFrame(raf);
  }, []);

// Animación de entrada del navbar
  useEffect(() => {
    tl.to(navBar.current, {
      y: 0,
      duration: 2,
      delay: 0.5,
      ease: "power4.inOut",
    });
  }, []);

  useEffect(() => {
    if (!sectionRefs || sectionRefs.length === 0) return;

    sectionRefs.forEach((section) => {
      const id = section.id;

      const isWhite = ["hero", "contactanos", "¿Cómo_funciona?"].includes(id);
      const isBlue = ["¿Por_qué_elegirnos?", "padres", "colegios"].includes(id);

      const timeline = gsap.timeline({ defaults: { duration: 0.3, ease: "power2.out" } });

      if (isWhite) {
        timeline
            .to(navBar.current, {
              backgroundColor: "#ffffff",
              color: "#2563EB",
              immediateRender: false,
            })
            .to(cta.current, {
              backgroundColor: "#2563EB",
              color: "#ffffff",
              border: "1px solid transparent",
              immediateRender: false,
            }, 0);
      }

      if (isBlue) {
        timeline
            .to(navBar.current, {
              backgroundColor: "#EFF6FF",
              color: "#2563EB",
              immediateRender: false,
            })
            .to(cta.current, {
              backgroundColor: "transparent",
              color: "#2563EB",
              border: "1px solid #2563EB",
              immediateRender: false,
            }, 0);
      }

      ScrollTrigger.create({
        trigger: section,
        start: "top 400px",
        end: "bottom 300px",
        animation: timeline,
        toggleActions: "play reverse play reverse",
      });
    });
  }, [sectionRefs]);



  return (
      <header
          ref={navBar}
          className="fixed top-0 z-50 w-full -translate-y-full flex items-center justify-between bg-white px-5 py-3 shadow-md"
      >

        {/* Logo */}
        <a href="#hero" aria-label="Logo" className="flex items-center gap-2">
          <svg
              width="36"
              height="36"
              viewBox="0 0 150 150"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              className="w-8 h-8 md:w-10 md:h-10"
          >
            <path
                d="M47.4187 14.1875C48.0937 13.875 48.7812 13.575 49.4812 13.2875L51.6375 12.4438C61.9063 8.65005 75.4625 6.9563 98.3875 12.6875C108.631 15.25 116.325 23.2125 121.312 32.1875C127.575 43.4625 131.25 58.6125 131.25 75C131.25 91.3938 127.575 106.538 121.312 117.813C116.319 126.788 108.625 134.75 98.3875 137.313C75.4625 143.044 61.9063 141.35 51.6375 137.563L49.4875 136.713C48.7952 136.426 48.1076 136.128 47.425 135.819C38.6937 131.863 31.5625 123.481 26.6625 113.081C21.7062 102.563 18.75 89.4313 18.75 75C18.75 60.5688 21.7062 47.4375 26.6625 36.9188C31.5625 26.5188 38.6875 18.1375 47.4187 14.1875ZM93.75 25C88.4188 25 82.2812 28.9625 77.1187 38.2625C72.0625 47.35 68.75 60.325 68.75 75C68.75 89.675 72.0625 102.65 77.1187 111.738C82.2812 121.038 88.4188 125 93.75 125C99.0812 125 105.219 121.038 110.381 111.738C115.437 102.65 118.75 89.675 118.75 75C118.75 60.325 115.437 47.35 110.381 38.2625C105.219 28.9625 99.0812 25 93.75 25ZM93.75 53.125C98.1625 53.125 101.312 56.6188 103.175 60.3438C105.131 64.2563 106.25 69.4438 106.25 75C106.25 80.5563 105.125 85.7438 103.175 89.6563C101.312 93.3813 98.1625 96.875 93.75 96.875C89.3375 96.875 86.1875 93.3813 84.325 89.6563C82.375 85.7438 81.25 80.5563 81.25 75C81.25 69.4438 82.375 64.2563 84.325 60.3438C86.1875 56.625 89.3375 53.125 93.75 53.125Z"
                fill="#2563EB"
            />
          </svg>

          <svg width="120" height="60" viewBox="0 0 819 189" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M101.313 116.625C93.3635 116.625 86.5135 114.65 80.7635 110.7C75.0635 106.75 70.8885 100.85 68.2385 93C65.5885 85.1 64.8385 75.325 65.9885 63.675C67.1885 51.975 69.8385 42.2 73.9385 34.35C78.0385 26.5 83.2635 20.6 89.6135 16.65C96.0135 12.7 103.213 10.725 111.213 10.725C122.763 10.725 131.238 13.775 136.638 19.875C142.038 25.925 144.763 33.75 144.813 43.35L121.038 47.85C120.538 43.65 119.388 40.175 117.588 37.425C115.788 34.625 112.988 33.225 109.188 33.225C106.088 33.225 103.213 34.325 100.563 36.525C97.9135 38.725 95.6635 42.075 93.8135 46.575C91.9635 51.025 90.6635 56.725 89.9135 63.675C89.3135 70.525 89.4885 76.175 90.4385 80.625C91.3885 85.075 92.9635 88.375 95.1635 90.525C97.4135 92.675 100.138 93.75 103.338 93.75C107.788 93.75 111.238 92.425 113.688 89.775C116.188 87.125 117.663 83.9 118.113 80.1H142.038C141.238 87.95 139.138 94.6 135.738 100.05C132.338 105.45 127.738 109.575 121.938 112.425C116.188 115.225 109.313 116.625 101.313 116.625ZM184.526 116.625C178.326 116.625 172.751 115.225 167.801 112.425C162.901 109.575 159.176 105.225 156.626 99.375C154.076 93.525 153.201 86.125 154.001 77.175C154.851 67.925 157.101 60.375 160.751 54.525C164.451 48.675 169.026 44.375 174.476 41.625C179.926 38.875 185.676 37.5 191.726 37.5C197.726 37.5 203.176 38.875 208.076 41.625C212.976 44.375 216.726 48.675 219.326 54.525C221.926 60.325 222.801 67.875 221.951 77.175C221.051 86.175 218.751 93.6 215.051 99.45C211.401 105.25 206.901 109.575 201.551 112.425C196.201 115.225 190.526 116.625 184.526 116.625ZM185.726 94.875C188.676 94.875 191.551 93.55 194.351 90.9C197.201 88.25 198.951 83.675 199.601 77.175C200.251 70.425 199.651 65.7 197.801 63C196.001 60.3 193.626 58.95 190.676 58.95C187.626 58.95 184.601 60.325 181.601 63.075C178.651 65.775 176.826 70.475 176.126 77.175C175.676 81.525 175.851 85 176.651 87.6C177.501 90.2 178.751 92.075 180.401 93.225C182.051 94.325 183.826 94.875 185.726 94.875ZM260.392 116.625C255.042 116.625 250.267 115.175 246.067 112.275C241.867 109.325 238.567 105.225 236.167 99.975C233.817 94.675 232.642 88.5 232.642 81.45C232.642 74.85 233.517 68.875 235.267 63.525C237.067 58.125 239.517 53.5 242.617 49.65C245.767 45.75 249.367 42.75 253.417 40.65C257.467 38.55 261.767 37.5 266.317 37.5C270.167 37.5 273.492 38.275 276.292 39.825C279.092 41.375 281.342 43.725 283.042 46.875L286.567 10.2H309.142L299.167 114H280.942L279.292 102.975C276.842 107.675 273.942 111.125 270.592 113.325C267.292 115.525 263.892 116.625 260.392 116.625ZM266.317 93.9C268.217 93.9 270.142 93.25 272.092 91.95C274.042 90.65 275.717 88.875 277.117 86.625C278.567 84.325 279.417 81.725 279.667 78.825L280.042 76.65C280.142 76.2 280.192 75.75 280.192 75.3C280.192 74.8 280.192 74.4 280.192 74.1C280.242 71.2 279.867 68.7 279.067 66.6C278.267 64.5 277.117 62.875 275.617 61.725C274.117 60.525 272.292 59.925 270.142 59.925C267.692 59.925 265.517 60.45 263.617 61.5C261.717 62.5 260.117 63.875 258.817 65.625C257.567 67.375 256.592 69.4 255.892 71.7C255.242 73.95 254.917 76.325 254.917 78.825C254.917 83.325 255.892 86.975 257.842 89.775C259.842 92.525 262.667 93.9 266.317 93.9ZM348.625 116.625C342.925 116.625 337.75 114.925 333.1 111.525C328.45 108.075 324.85 103.35 322.3 97.35C319.8 91.3 318.925 84.4 319.675 76.65C320.425 68.45 322.6 61.45 326.2 55.65C329.85 49.8 334.3 45.325 339.55 42.225C344.8 39.075 350.3 37.5 356.05 37.5C361.55 37.5 366.15 38.675 369.85 41.025C373.55 43.325 376.45 46.425 378.55 50.325C380.65 54.225 382.025 58.6 382.675 63.45C383.325 68.25 383.3 73.15 382.6 78.15C382.35 79.2 382.1 80.1 381.85 80.85C381.65 81.6 381.45 82.425 381.25 83.325H337.525L341.2 80.175C340.6 83.475 340.55 86.375 341.05 88.875C341.6 91.375 342.65 93.325 344.2 94.725C345.8 96.125 347.875 96.825 350.425 96.825C352.075 96.825 353.625 96.4 355.075 95.55C356.575 94.65 357.7 93.25 358.45 91.35H380.65C379.6 95.95 377.575 100.175 374.575 104.025C371.625 107.825 367.925 110.875 363.475 113.175C359.075 115.475 354.125 116.625 348.625 116.625ZM342.1 71.7L338.95 68.475H366.025L362.35 71.7C362.7 69.45 362.75 67.225 362.5 65.025C362.3 62.775 361.55 60.925 360.25 59.475C359 57.975 357 57.225 354.25 57.225C352.05 57.225 350.075 57.8 348.325 58.95C346.575 60.1 345.15 61.775 344.05 63.975C343 66.125 342.35 68.7 342.1 71.7ZM395.746 114L405.271 13.05H437.071L450.646 63.75L474.271 13.05H504.796L495.421 114H472.921L479.446 41.175L480.496 41.7L453.796 104.775H439.621L423.871 37.8L424.921 37.5L417.946 114H395.746ZM539.207 30.975C534.957 30.975 531.782 29.775 529.682 27.375C527.632 24.925 526.732 21.475 526.982 17.025C527.382 12.675 528.907 9.29999 531.557 6.89999C534.207 4.44999 537.557 3.22499 541.607 3.22499C545.757 3.22499 548.882 4.44999 550.982 6.89999C553.082 9.34999 554.007 12.725 553.757 17.025C553.357 21.425 551.857 24.85 549.257 27.3C546.657 29.75 543.307 30.975 539.207 30.975ZM520.457 114L527.582 39.525H549.782L542.657 114H520.457ZM567.358 114L574.408 39.675H593.758L594.958 50.325C597.858 45.875 601.083 42.625 604.633 40.575C608.233 38.525 612.008 37.5 615.958 37.5C621.708 37.5 626.258 38.95 629.608 41.85C632.958 44.7 635.258 48.65 636.508 53.7C637.758 58.7 638.108 64.425 637.558 70.875L633.658 114H610.933L614.833 70.875C615.333 67.225 614.883 64.5 613.483 62.7C612.133 60.85 610.283 59.925 607.933 59.925C604.483 59.925 601.233 61.675 598.183 65.175C595.133 68.675 593.183 74.65 592.333 83.1L589.558 114H567.358ZM679.337 116.625C673.987 116.625 669.212 115.175 665.012 112.275C660.812 109.325 657.512 105.225 655.112 99.975C652.762 94.675 651.587 88.5 651.587 81.45C651.587 74.85 652.462 68.875 654.212 63.525C656.012 58.125 658.462 53.5 661.562 49.65C664.712 45.75 668.312 42.75 672.362 40.65C676.412 38.55 680.712 37.5 685.262 37.5C689.112 37.5 692.437 38.275 695.237 39.825C698.037 41.375 700.287 43.725 701.987 46.875L705.512 10.2H728.087L718.112 114H699.887L698.237 102.975C695.787 107.675 692.887 111.125 689.537 113.325C686.237 115.525 682.837 116.625 679.337 116.625ZM685.262 93.9C687.162 93.9 689.087 93.25 691.037 91.95C692.987 90.65 694.662 88.875 696.062 86.625C697.512 84.325 698.362 81.725 698.612 78.825L698.987 76.65C699.087 76.2 699.137 75.75 699.137 75.3C699.137 74.8 699.137 74.4 699.137 74.1C699.187 71.2 698.812 68.7 698.012 66.6C697.212 64.5 696.062 62.875 694.562 61.725C693.062 60.525 691.237 59.925 689.087 59.925C686.637 59.925 684.462 60.45 682.562 61.5C680.662 62.5 679.062 63.875 677.762 65.625C676.512 67.375 675.537 69.4 674.837 71.7C674.187 73.95 673.862 76.325 673.862 78.825C673.862 83.325 674.837 86.975 676.787 89.775C678.787 92.525 681.612 93.9 685.262 93.9ZM764.72 116.625C759.47 116.625 754.52 115.725 749.87 113.925C745.27 112.075 741.67 109.225 739.07 105.375C736.47 101.525 735.545 96.575 736.295 90.525H756.77C756.37 92.825 756.795 94.5 758.045 95.55C759.345 96.6 761.37 97.125 764.12 97.125C767.32 97.125 769.57 96.6 770.87 95.55C772.17 94.45 772.895 93.325 773.045 92.175C773.245 90.775 772.82 89.725 771.77 89.025C770.72 88.325 769.695 87.75 768.695 87.3L752.945 80.325C748.595 78.425 745.27 75.675 742.97 72.075C740.67 68.425 739.77 64.25 740.27 59.55C740.77 54.9 742.47 50.95 745.37 47.7C748.27 44.4 752.045 41.875 756.695 40.125C761.345 38.375 766.545 37.5 772.295 37.5C782.145 37.5 789.145 39.85 793.295 44.55C797.495 49.25 799.32 55.125 798.77 62.175H778.145C778.245 60.575 777.745 59.275 776.645 58.275C775.595 57.275 773.845 56.775 771.395 56.775C769.995 56.775 768.72 56.95 767.57 57.3C766.42 57.65 765.495 58.15 764.795 58.8C764.145 59.45 763.77 60.225 763.67 61.125C763.57 62.175 763.92 63 764.72 63.6C765.52 64.15 766.27 64.6 766.97 64.95L785.045 73.425C788.895 75.225 792.12 77.65 794.72 80.7C797.32 83.75 798.42 87.575 798.02 92.175C797.72 96.125 796.195 99.975 793.445 103.725C790.695 107.475 786.895 110.575 782.045 113.025C777.195 115.425 771.42 116.625 764.72 116.625Z"
                fill="#2563EB"/>
            <path d="M82 172.5V138.5H774.5L82 172.5Z" fill="#2563EB" stroke="white"/>
            </svg>

        </a>

        {/* Nav Links */}
        <nav
            className="absolute left-1/2 transform -translate-x-1/2 flex gap-6 items-center justify-center font-medium text-sm md:text-xl text-gray-800">
          <a href="#hero" className="relative group hidden md:inline-block">
            <span>Inicio</span>
            <span
                className="absolute bottom-0 left-0 h-[2px] w-0 rounded-full bg-secondary-800 transition-all duration-300 group-hover:w-full"></span>
          </a>
          <a href="#¿Por_qué_elegirnos?" className="relative group hidden md:inline-block">
            <span>Beneficios</span>
            <span
                className="absolute bottom-0 left-0 h-[2px] w-0 rounded-full bg-secondary-800 transition-all duration-300 group-hover:w-full"></span>
          </a>
          <a href="#¿Cómo_funciona?" className="relative group hidden md:inline-block">
            <span>Características</span>
            <span
                className="absolute bottom-0 left-0 h-[2px] w-0 rounded-full bg-secondary-800 transition-all duration-300 group-hover:w-full"></span>
          </a>

          <a href="#padres" className="relative group hidden md:inline-block">
            <span>Para padres</span>
            <span
                className="absolute bottom-0 left-0 h-[2px] w-0 rounded-full bg-secondary-800 transition-all duration-300 group-hover:w-full"></span>
          </a>
          <a href="#colegios" className="relative group hidden md:inline-block">
            <span>Para colegios</span>
            <span
                className="absolute bottom-0 left-0 h-[2px] w-0 rounded-full bg-secondary-800 transition-all duration-300 group-hover:w-full"></span>
          </a>


          <a href="#contactanos" className="relative group hidden md:inline-block">
            <span>Contáctenos</span>
            <span
                className="absolute bottom-0 left-0 h-[2px] w-0 rounded-full bg-secondary-800 transition-all duration-300 group-hover:w-full"></span>
          </a>


        </nav>

        <a
            ref={cta}
            href="#Login"
            className="ml-4 px-4 py-2 rounded-full bg-secondary-800 text-white hover:bg-transparent hover:text-secondary-800 border border-secondary-800 transition"
        >
          Iniciar Sesión
        </a>
      </header>
  );
}
